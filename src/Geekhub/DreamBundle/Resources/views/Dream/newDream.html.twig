{% extends 'GeekhubResourceBundle::layout.html.twig' %}

{% block body %}
    <div class="container" id="wrap">
        {#{% include 'GeekhubResourceBundle:includes:menu.html.twig' %}#}

                <div style="margin-top: 50px;">

                <div class="col-md-6 col-md-offset-3">
                {{ form_start(form, {'attr': {'role': 'form', 'novalidate': 'novalidate' }}) }}
                    {{ form_row(form.title, {'attr': {'value': 'new title dream', 'class': 'form-control'} }) }}
                    {{ form_row(form.description, {'attr': {'class': 'form-control'} }) }}
                    {{ form_row(form.phone, {'attr': {'value': 'phone number', 'class': 'form-control'} }) }}
                    {{ form_row(form.expiredDate, {'attr': {'class': 'form-control'} }) }}
                    <div class="checkbox">
                        {{ form_row(form.hiddenPhone) }}
                    </div>
                    <br>

                    <p>Finance</p>
                    <ul class="financialResources" data-prototype="{{ form_widget(form.financialResources.vars.prototype)|e }}">
                    {% for finance in form.financialResources %}
                        <li> {{ form_row(finance.title, {'attr': {'class': 'form-control'} }) }}</li>
                        <li> {{ form_row(finance.quantity, {'attr': {'class': 'form-control'} }) }}</li>
                    {% endfor %}
                    </ul>
                    <p>Equipment</p>
                    <ul class="equipmentResources" data-prototype="{{ form_widget(form.equipmentResources.vars.prototype)|e }}">
                        {% for equipment in form.equipmentResources %}
                            <li> {{ form_row(equipment.title, {'attr': {'class': 'form-control'} }) }}</li>
                            <li> {{ form_row(equipment.quantity, {'attr': {'class': 'form-control'} }) }}</li>
                            <li> {{ form_row(equipment.quantityType, {'attr': {'class': 'form-control'} }) }}</li>
                        {% endfor %}
                    </ul>
                    <p>Work</p>
                    <ul class="workResources" data-prototype="{{ form_widget(form.workResources.vars.prototype)|e }}">
                        {% for work in form.workResources %}
                            <li> {{ form_row(work.title, {'attr': {'class': 'form-control'} }) }}</li>
                            <li> {{ form_row(work.quantity, {'attr': {'class': 'form-control'} }) }}</li>
                            <li> {{ form_row(work.quantityDays, {'attr': {'class': 'form-control'} }) }}</li>
                        {% endfor %}
                    </ul>

                <br>
                    <input type="submit" value="Ok" class="text-center btn btn-default">
                {{ form_end(form) }}
                </div>

                </div>

<script>
jQuery(document).ready(function() {
    var $collectionFinHolder, $collectionEquipHolder, $collectionWorkHolder;

    var $addFinLink = $('<a href="#" class="add_fin_link">Add a fin</a>');
    var $newFinLinkLi = $('<li></li>').append($addFinLink);

    var $addEquipLink = $('<a href="#" class="add_equip_link">Add a equip</a>');
    var $newEquipLinkLi = $('<li></li>').append($addEquipLink);

    var $addWorkLink = $('<a href="#" class="add_work_link">Add a work</a>');
    var $newWorkLinkLi = $('<li></li>').append($addWorkLink);

    $collectionFinHolder = $('ul.financialResources');
    $collectionEquipHolder = $('ul.equipmentResources');
    $collectionWorkHolder = $('ul.workResources');

    $collectionFinHolder.find('li').each(function() {
        addFinFormDeleteLink($(this));
    });

    $collectionEquipHolder.find('li').each(function() {
        addEquipFormDeleteLink($(this));
    });

    $collectionWorkHolder.find('li').each(function() {
        addWorkFormDeleteLink($(this));
    });

    $collectionFinHolder.append($newFinLinkLi);
    $collectionEquipHolder.append($newEquipLinkLi);
    $collectionWorkHolder.append($newWorkLinkLi);

    $collectionFinHolder.data('index', $collectionFinHolder.find(':input').length);
    $collectionEquipHolder.data('index', $collectionEquipHolder.find(':input').length);
    $collectionWorkHolder.data('index', $collectionWorkHolder.find(':input').length);

    $addFinLink.on('click', function(e) {
        e.preventDefault();
        addFinForm($collectionFinHolder, $newFinLinkLi);
    });
    $addEquipLink.on('click', function(e) {
        e.preventDefault();
        addEquipForm($collectionEquipHolder, $newEquipLinkLi);
    });
    $addWorkLink.on('click', function(e) {
        e.preventDefault();
        addWorkForm($collectionWorkHolder, $newWorkLinkLi);
    });
});

function addFinForm($collectionHolder, $newLinkLi) {
    var prototype = $collectionHolder.data('prototype');
    var index = $collectionHolder.data('index');
    var newForm = prototype.replace(/__name__/g, index);
    var $newFormLi = $('<li></li>').append(newForm);

    $collectionHolder.data('index', index + 1);
    $newLinkLi.before($newFormLi);
    addFinFormDeleteLink($newFormLi);
}

function addEquipForm($collectionHolder, $newLinkLi) {
    var prototype = $collectionHolder.data('prototype');
    var index = $collectionHolder.data('index');
    var newForm = prototype.replace(/__name__/g, index);
    var $newFormLi = $('<li></li>').append(newForm);

    $collectionHolder.data('index', index + 1);
    $newLinkLi.before($newFormLi);
    addEquipFormDeleteLink($newFormLi);
}

function addWorkForm($collectionHolder, $newLinkLi) {
    var prototype = $collectionHolder.data('prototype');
    var index = $collectionHolder.data('index');
    var newForm = prototype.replace(/__name__/g, index);
    var $newFormLi = $('<li></li>').append(newForm);

    $collectionHolder.data('index', index + 1);
    $newLinkLi.before($newFormLi);
    addWorkFormDeleteLink($newFormLi);
}

function addFinFormDeleteLink($finFormLi) {
    var $removeFormA = $('<a href="#" class="delete_fin_link">delete this item</a>');
    $finFormLi.append($removeFormA);

    $removeFormA.on('click', function(e) {
        e.preventDefault();
        $finFormLi.remove();
    });
}

function addEquipFormDeleteLink($finFormLi) {
    var $removeFormA = $('<a href="#" class="delete_equip_link">delete this item</a>');
    $finFormLi.append($removeFormA);

    $removeFormA.on('click', function(e) {
        e.preventDefault();
        $finFormLi.remove();
    });
}

function addWorkFormDeleteLink($finFormLi) {
    var $removeFormA = $('<a href="#" class="delete_work_link">delete this item</a>');
    $finFormLi.append($removeFormA);

    $removeFormA.on('click', function(e) {
        e.preventDefault();
        $finFormLi.remove();
    });
}

</script>

    </div>
    {#{% include 'GeekhubResourceBundle:includes:footer.html.twig' %}#}
{% endblock %}
